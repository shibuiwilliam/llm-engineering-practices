# Synthetic Prompt Testing Pattern

## 説明  
Synthetic Prompt Testing Pattern は、実際の運用データを使わずに「合成的に生成したテストプロンプト」を用いることで、プロンプト設計の品質と堅牢性を CI/CD で自動検証するパターンです。  
- **シナリオ作成**：典型ケース、エッジケース、異常系をカバーする合成プロンプトセットを用意  
- **期待結果定義**：各合成プロンプトに対して、期待される出力の正規表現や構造スキーマを定義  
- **テスト実行**：テストランナーが合成プロンプトを LLM に投入し、実際の出力と期待結果を比較  
- **カバレッジ測定**：プロンプト仕様書やドメイン要件に対してテストプロンプトの網羅度を可視化  

## 用途  
- **プロンプト変更時の品質保証**：テンプレート改修やパラメータ調整後に、自動的に主要パターンの出力安定性を確認  
- **サブプロンプト単位検証**：複雑プロンプトを機能別サブプロンプトに分割し、それぞれを合成テスト  
- **CI パイプライン統合**：Git プッシュ／マージ時にテストが自動実行され、不具合を早期検出  
- **ドメイン移植テスト**：新たな業務領域への適用時、基本パターンがドメイン知識に適合するか検証  

## 解決する課題  
1. **開発中の品質漏れ**  
   - 手動テストだけでは網羅できないケースが本番で顕在化  
2. **再現性不足**  
   - 過去に成功していたプロンプトが改修で破壊されても検出が遅れる  
3. **テストデータ依存**  
   - 実ユーザデータ利用制限（PII、プライバシー）でテスト網羅が難航  
4. **回帰テスト困難**  
   - 手順化されていないテストでは変更影響を継続的に確認できない  

## 対象とするシステム／プロジェクト  
- **チャットボット開発**：FAQ パターンや対話フローの基本応答を合成プロンプトで自動検証  
- **RAG 要約パイプライン**：代表ドキュメント例から生成される要約の構造チェック  
- **データ抽出 API**：住所・日付・金額などフィールド抽出の正規化テスト  
- **コード生成ツール**：仕様→コードのマッピング例を合成し、構文エラーや規約違反を検出  

## 利用するメリット  
- **高速フィードバック**：PR マージ前にテストが自動実行され、問題を即時発見  
- **セキュア**：実ユーザデータ不要でテスト可能、PII 漏洩リスクを排除  
- **網羅性向上**：典型／エッジ／異常系を体系立ててテストケース化  
- **ドキュメント化**：テストプロンプトが仕様書代わりとなり、設計意図を明確化  

## 注意点とトレードオフ  
- **テストシナリオ作成コスト**  
  - 合成プロンプトセットの設計・更新に時間がかかる  
- **模擬データの現実乖離**  
  - 合成ケースが実運用の複雑さを完全に再現できず、カバレッジギャップが生じる  
- **メンテナンス負荷**  
  - プロンプト仕様変更時はテストケースも併せて更新する必要  
- **過剰テストリスク**  
  - テストケースが増えすぎると CI 時間が延び、開発効率を低下させる  

## 導入のヒント  
1. **シナリオテンプレート化**  
   - ドメイン共通の「正常系」「異常系」「境界値」をテンプレート化し、再利用  
2. **優先度付けテスト**  
   - クリティカルパスのテストを必須、その他は週次バッチで実行など層別化  
3. **自動データ生成ツール活用**  
   - Faker やカスタムスクリプトで多様なテスト入力をプログラム的に生成  
4. **結果スナップショット保存**  
   - テスト出力のスナップショットを CI アーティファクトとして保管し、差分追跡  
5. **失敗分析ダッシュボード**  
   - テスト失敗ケースを可視化し、原因・改修箇所をチームで迅速に共有  
