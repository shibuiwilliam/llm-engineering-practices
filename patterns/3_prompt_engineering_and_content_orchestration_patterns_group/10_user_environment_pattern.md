# User Environment Pattern

## 説明  
User Environment Pattern は、ユーザからのリクエストに含まれる「暗黙の文脈」（タイムゾーン、言語、地域、ユーザ属性、デバイス状況、天気など）を明示的にプロンプトに取り込むことで、LLM の応答をユーザ状況に最適化する手法です。  
- **環境情報の収集**：リクエスト前にユーザ環境（場所、言語、時刻、デバイス、過去履歴など）を取得  
- **プロンプトエンリッチ**：`system` メッセージやテンプレート変数として環境情報を注入  
- **動的アダプタ**：環境ごとに異なるプロンプトブロック（地域特有の表現、時間帯に応じた挨拶など）を挿入  

## 用途  
- **パーソナライズドチャット**：ユーザの現地時間で挨拶や推奨事項を変える  
- **多言語対応 FAQ**：ユーザの言語設定に応じてプロンプトを切り替え  
- **ローカル情報提供**：天気・交通情報など地域データを含めた案内生成  
- **状況説明付きアシスタント**：デバイス種類やネットワーク状況を踏まえた操作ガイド  

## 解決する課題  
1. **一律応答の不適切さ**  
   - グローバルに同一プロンプトを使うと、ユーザの文化・時間帯に合わない表現になる  
2. **コンテキスト不足による品質低下**  
   - 「今何時？」といった前提を与えないと、生成結果がユーザの状況とズレる  
3. **UX のパーソナライズ欠如**  
   - プロンプトが固定だと、ユーザ体験が画一的で魅力に欠ける  
4. **誤情報リスク**  
   - 実際の環境を無視すると、古い天気情報や無効な操作手順を返す恐れ  

## 対象とするシステム／プロジェクト  
- **グローバル対応チャットボット**：多言語・多文化に適応した対話エージェント  
- **モバイル／IoT アシスタント**：デバイス種別やネットワーク状態に最適化した操作案内  
- **位置情報連携サービス**：位置ベースのレストラン検索や観光ガイド  
- **ウェザーレポート・交通情報配信**：リアルタイムな地域情報を含む自動レポート  

## 利用するメリット  
- **高度なパーソナライズ**：ユーザ状況を考慮した自然な応答を実現  
- **コンテキスト整合性**：常に最新かつ正しい情報を前提に生成  
- **ユーザ満足度向上**：親しみやすい挨拶や提案でエンゲージメント強化  
- **エラー防止**：デバイス状況や権限を加味した指示で誤操作を減少  

## 注意点とトレードオフ  
- **プライバシー懸念**  
  - 位置情報や個人属性を扱うため、収集・利用ポリシーと暗号化／マスキングが必須  
- **環境データの鮮度**  
  - 天気・時刻・ネットワークなど動的データはキャッシュせず最新を取得する必要  
- **プロンプト複雑化**  
  - 挿入する環境要素が増えるとテンプレートが肥大化し、管理コストが上昇  
- **フォールバック設計**  
  - 環境取得に失敗した場合のデフォルト値や警告メッセージを用意する必要  

## 導入のヒント  
1. **最小限の環境セットから開始**  
   - まずは言語と時刻帯だけを挿入し、効果を検証  
2. **環境取得モジュールを分離**  
   - 専用サービス／ミドルウェアで環境情報を集約し、プロンプト生成層から疎結合  
3. **テンプレートライブラリ化**  
   - 環境要素ごとにプロンプトスニペットを管理し、必要に応じて組み合わせ  
4. **プライバシー・セキュリティ対策**  
   - 必要最小限の情報収集と暗号化、ユーザ同意取得フローを整備  
5. **モニタリングとログ**  
   - 環境エンリッチ結果と生成応答をログし、品質やプライバシーリスクを継続監視  
