# Security & Compliance Patterns

## グループ概要

**Security & Compliance Patterns** は、LLM システムのデータ保護・アクセス制御・プライバシー遵守・監査要件を満たすための設計指針です。エンタープライズ導入や規制産業で必須となる **機密性 (Confidentiality)、完全性 (Integrity)、可用性 (Availability)** を実現し、業界基準 (ISO 27001、SOC2、GDPR 等) に対応します。

### 主なユースケース
| ユースケース | 目的 | 代表パターン |
|--------------|------|--------------|
| 金融機関向け AI アシスタント | 機密データ保護と厳格監査 | Confidential Prompt Proxy / Audit Logging |
| 医療・ヘルスケアチャットボット | PII / PHI 保護・HIPAA 準拠 | Zero Trust API / Content Moderation |
| 社内 RAG ナレッジ検索 | 部署別アクセス制御 | Role‑Based Prompt Control / Policy‑Based Access |
| B2B SaaS マルチテナント | テナント分離、匿名利用者サポート | Anonymous Session Mgmt / Prompt Control |

---

## パターン詳細

### 1. Role‑Based Prompt Control Pattern
| 項目 | 内容 |
|------|------|
| **説明** | ユーザーの RBAC (Role‑Based Access Control) に基づき、使用可能プロンプトや出力範囲を制限。 |
| **用途** | 部署別・階層別の応答差別化。 |
| **解決課題** | 全ユーザー共通プロンプトで機密情報が漏れるリスク。 |
| **対象システム** | 社内 Q&A、ヘルプデスク。 |
| **メリット** | 最小権限原則で内部統制。 |
| **注意点** | 役割更新時のプロンプト再適用漏れ防止。 |

---

### 2. Audit Logging with Prompt & Response Pattern
| 項目 | 内容 |
|------|------|
| **説明** | プロンプト・応答・エラー・ユーザ ID を tamper‑proof で保存し、追跡可能に。 |
| **用途** | 法規制・内部監査。 |
| **解決課題** | 不正アクセス・誤回答の原因特定不可。 |
| **対象システム** | 金融・公共機関システム。 |
| **メリット** | 透明性・証跡・ポストモーテム容易。 |
| **注意点** | ログ改ざん防止 (WORM ストレージ等) と PII マスキング。 |

---

### 3. Content Moderation Pre‑Check Pattern
| 項目 | 内容 |
|------|------|
| **説明** | ユーザー入力を LLM 送信前に Safe‑List / Block‑List で検査、ガイドライン違反を遮断。 |
| **用途** | 公開ユーザー生成コンテンツ (UGC)。 |
| **解決課題** | ハラスメント、違法コンテンツ入力。 |
| **対象システム** | SNS チャットボット、フォーラム。 |
| **メリット** | 品質・法的リスク低減。 |
| **注意点** | 監視基準の継続アップデート。 |

---

### 4. Zero Trust API Communication Pattern
| 項目 | 内容 |
|------|------|
| **説明** | 内部・外部通信を TLS + 双方向認証 + 最小権限トークンで保護し、ネットワークを前提に信頼しない設計。 |
| **用途** | マイクロサービス間通信、外部 API 接続。 |
| **解決課題** | 内部ネットワークを前提とした脆弱設計。 |
| **対象システム** | マルチクラウド／ハイブリッド環境。 |
| **メリット** | 横展開攻撃を防御、規制遵守。 |
| **注意点** | 証明書管理とパフォーマンスオーバーヘッド。 |

---

### 5. Confidential Prompt Proxy Pattern
| 項目 | 内容 |
|------|------|
| **説明** | 機密/PII データを検出→暗号化 or マスキング後に外部 LLM へ送信、戻り値を復号。 |
| **用途** | PII / PHI を扱う対話型システム。 |
| **解決課題** | 外部ベンダーに生データ送信できない。 |
| **対象システム** | 医療カルテ要約、法務文書レビュー。 |
| **メリット** | ベンダーロックなしで秘匿性確保。 |
| **注意点** | マスキング漏れテスト・鍵管理。 |

---

### 6. Anonymous Session Management Pattern
| 項目 | 内容 |
|------|------|
| **説明** | ログイン前のユーザーにも一意セッション ID を発行し、匿名状態でも追跡・レート制限を適用。 |
| **用途** | 体験版チャット、パブリックデモ。 |
| **解決課題** | 匿名ユーザ乱用・スパム。 |
| **対象システム** | 広告付き AI チャットサイト。 |
| **メリット** | UX 向上とセキュリティ両立。 |
| **注意点** | Cookie/LocalStorage 依存リスク。 |

---

### 7. Policy‑Based LLM Access Control Pattern
| 項目 | 内容 |
|------|------|
| **説明** | JSON / YAML で宣言的に記述したアクセスポリシーをエンフォースし、ユーザー属性に応じて動的制御。 |
| **用途** | マルチテナント & 多権限レイヤ運用。 |
| **解決課題** | コードに組込まれた静的 if/else の爆発。 |
| **対象システム** | B2B SaaS、ISP スケール。 |
| **メリット** | アクセス権変更が即時適用、監査容易。 |
| **注意点** | ポリシー衝突時の優先順位設計。

---

## アンチパターン

### 1. Security Through Obscurity（隠蔽による擬似セキュリティ）
- **概要**: システム仕様を公開しないだけで安全と過信し、暗号化・認証が未整備。
- **問題点**: 秘密が漏れた瞬間に完全破綻。
- **事例**: hard‑coded API キーが GitHub に流出→全データ抜取。

### 2. One‑size‑fits‑all Access Control（単一レベルアクセス）
- **概要**: すべてのユーザに同一権限を付与、最小権限設計を無視。
- **問題点**: 内部不正・データ漏洩リスク増。
- **事例**: アルバイトが全顧客 PII へアクセス可能→情報流出事故。

### 3. Stale Policy Pattern（陳腐化ポリシー）
- **概要**: ポリシー更新が長期間行われず、組織構造・法規制の変化に追随しない。
- **問題点**: 違反状態温存、緊急時ロールバックが困難。
- **事例**: GDPR 施行後も旧ログ保持ポリシーのまま→巨額制裁金。
